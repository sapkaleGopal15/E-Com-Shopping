<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{index :: parent(~{::#content}, ~{::title})}">
<head>
    <meta charset="UTF-8">
    <title>Gopal Shop | Admin Panel | All Orders</title>
    <script src="https://kit.fontawesome.com/a2d9d6a60f.js" crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 text-gray-800 font-sans">
<div id="content">
<section class="py-8 px-4">
    <div class="max-w-7xl mx-auto shadow-2xl bg-white rounded-2xl p-8 transition-all duration-500 hover:shadow-3xl mt-5">

        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold bg-linear-to-r from-indigo-600 to-blue-400 bg-clip-text text-transparent">
                All Orders
            </h2>
            <a th:href="@{/admin/}" class="text-white bg-linear-to-r from-indigo-600 to-blue-500 px-4 py-2 rounded-md shadow-md hover:scale-105 transition-all duration-300">
                <i class="fa-solid fa-arrow-left mr-2"></i> Back
            </a>
        </div>

        <hr class="mb-4">

        <div>
            <th:block th:if="${session.successMsg}">
                <p class="text-green-600 font-semibold text-center mb-3 animate-pulse">
                    [[${session.successMsg}]]
                </p>
                <th:block th:text="${@commonServiceImpl.removeMessage()}"></th:block>
            </th:block>

            <th:block th:if="${session.errorMsg}">
                <p class="text-red-600 font-semibold text-center mb-3 animate-pulse">
                    [[${session.errorMsg}]]
                </p>
                <th:block th:text="${@commonServiceImpl.removeMessage()}"></th:block>
            </th:block>
        </div>

        <form th:action="@{'/admin/search-order'}" method="post" class="flex items-center gap-3 mb-6">
            <input type="text" name="keyword"
                   placeholder="Enter order id"
                   class="grow border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none transition-all">
            <button class="bg-blue-500 text-white px-5 py-2 rounded-lg hover:bg-blue-600 transition-all duration-300 shadow-md">
                Search
            </button>
        </form>

        <div class="overflow-x-auto">
            <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                <thead class="bg-linear-to-r from-indigo-600 to-blue-400 text-white">
                <tr>
                    <th class="py-3 px-4 text-left">Sr No.</th>
                    <th class="py-3 px-4 text-left">Order ID</th>
                    <th class="py-3 px-4 text-left">Delivery Details</th>
                    <th class="py-3 px-4 text-left">Date</th>
                    <th class="py-3 px-4 text-left">Product</th>
                    <th class="py-3 px-4 text-left">Price</th>
                    <th class="py-3 px-4 text-left">Status</th>
                    <th class="py-3 px-4 text-left">Action</th>
                </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">

                <th:block th:if="${search != 'search'}">
                    <tr th:each="o, p:${orders}" class="hover:bg-blue-50 transition-all">
                        <td class="px-4 py-3 font-medium" th:text="${((orders.getNumber * 10) + p.index) + 1}"></td>
                        <td class="py-3 px-4 font-semibold text-gray-700">[[${o.id}]]</td>
                        <td class="py-3 px-4 text-sm">
                            <span class="font-semibold">Name:</span> [[${o.name}]]<br>
                           
                            <span class="font-semibold">Mobile:</span> [[${o.contact}]]<br>
                            <span class="font-semibold">Address:</span> [[${o.address}]], [[${o.city}]],
                            [[${o.state}]] - [[${o.pincode}]]
                        </td>

                        <td class="py-3 px-4">[[${o.orderDate}]]</td>
                        <td class="py-3 px-4">[[${o.productNames}]]</td>

                        <td class="py-3 px-4 text-sm">
                            Price: ₹[[${o.orderPrice}]]<br>
                            Payment Mode: [[${o.paymentMode}]]
                        </td>

                        <td class="py-3 px-4">
                            <div th:switch="${o.status}">
                                <div th:case="'Delivered'" th:text="${o.status}"
                                    class="px-2 py-1 rounded-md text-xs bg-green-500 text-white"></div>

                                <div th:case="'Cancelled'" th:text="${o.status}"
                                    class="px-2 py-1 rounded-md text-xs bg-red-500 text-white"></div>

                                <div th:case="*"
                                    th:text="${o.status}"
                                    class="px-2 py-1 rounded-md text-xs bg-yellow-400 text-black"></div>
                            </div>
                        </td>
                        <td class="py-3 px-4">
                            <th:block th:if="${o.status == 'Cancelled'}">
                                <span class="font-semibold">Reason:</span><br> [[${o.cancelReason}]]
                            </th:block>
                            <th:block th:unless="${o.status == 'Cancelled'}">
                                <th:block th:if="${o.status == 'Delivered'}">
                                    <span class="font-semibold">Order:</span><br> [[${o.cancelReason}]]
                                </th:block>
                                <th:block th:unless="${o.status == 'Delivered'}">
                                    <form th:action="@{'/admin/update-order-status/' +${o.id}}" method="post" class="flex gap-2 items-center">
                                        <select class="border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-blue-400" name="status">
                                            <option>--select--</option>
                                            <option value="In Progress">In Progress</option>
                                            <option value="Order Received">Order Received</option>
                                            <option value="Product Packed">Product Packed</option>
                                            <option value="Out for Delivery">Out for Delivery</option>
                                            <option value="Delivered">Delivered</option>
                                        </select>
                                        <input th:value="${o.id}" name="id" type="hidden">

                                        <button th:if="${o.status != 'Cancelled' && o.status != 'Delivered'}"
                                                class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-600 transition-all duration-300">
                                            Update
                                        </button>
                                        <button th:unless="${o.status != 'Cancelled' && o.status != 'Delivered'}"
                                                class="bg-gray-300 text-gray-500 px-3 py-1 rounded-lg text-sm cursor-not-allowed">
                                            Update
                                        </button>
                                    </form>
                                </th:block>
                            </th:block>
                        </td>
                    </tr>
                </th:block>

                <th:block th:if="${search == 'search'}">
                    <tr th:each="o, p:${orders}" class="hover:bg-blue-50 transition-all">
                        <td class="px-4 py-3 font-medium">[[${p.count}]]</td>
                        <td class="py-3 px-4 font-semibold text-gray-700">[[${o.id}]]</td>
                        <td class="py-3 px-4 text-sm">
                            <span class="font-semibold">Name:</span> [[${o.name}]]<br>
                           
                            <span class="font-semibold">Mobile:</span> [[${o.contact}]]<br>
                            <span class="font-semibold">Address:</span> [[${o.address}]], [[${o.city}]],
                            [[${o.state}]] - [[${o.pincode}]]
                        </td>

                        <td class="py-3 px-4">[[${o.orderDate}]]</td>
                        <td class="py-3 px-4">[[${o.productNames}]]</td>

                        <td class="py-3 px-4 text-sm">
                            Price: ₹[[${o.orderPrice}]]<br>
                            Payment Mode: [[${o.paymentMode}]]
                        </td>

                        <td class="py-3 px-4">
                            <div th:switch="${o.status}">
                                <div th:case="'Delivered'" th:text="${o.status}"
                                    class="px-2 py-1 rounded-md text-xs bg-green-500 text-white"></div>

                                <div th:case="'Cancelled'" th:text="${o.status}"
                                    class="px-2 py-1 rounded-md text-xs bg-red-500 text-white"></div>

                                <div th:case="*"
                                    th:text="${o.status}"
                                    class="px-2 py-1 rounded-md text-xs bg-yellow-400 text-black"></div>
                            </div>
                        </td>
                        <td class="py-3 px-4">
                            <th:block th:if="${o.status == 'Cancelled'}">
                                <span class="font-semibold">Reason:</span><br> [[${o.cancelReason}]]
                            </th:block>
                            <th:block th:unless="${o.status == 'Cancelled'}">
                                <th:block th:if="${o.status == 'Delivered'}">
                                    <span class="font-semibold">Order:</span><br> [[${o.cancelReason}]]
                                </th:block>
                                <th:block th:unless="${o.status == 'Delivered'}">
                                    <form th:action="@{'/admin/update-order-status/' +${o.id}}" method="post" class="flex gap-2 items-center">
                                        <select class="border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-blue-400" name="status">
                                            <option>--select--</option>
                                            <option value="In Progress">In Progress</option>
                                            <option value="Order Received">Order Received</option>
                                            <option value="Product Packed">Product Packed</option>
                                            <option value="Out For Delivery">Out for Delivery</option>
                                            <option value="Delivered">Delivered</option>
                                        </select>
                                        <input th:value="${o.id}" name="id" type="hidden">

                                        <button th:if="${o.status != 'Cancelled' && o.status != 'Delivered'}"
                                                class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-600 transition-all duration-300">
                                            Update
                                        </button>
                                        <button th:unless="${o.status != 'Cancelled' && o.status != 'Delivered'}"
                                                class="bg-gray-300 text-gray-500 px-3 py-1 rounded-lg text-sm cursor-not-allowed">
                                            Update
                                        </button>
                                    </form>
                                </th:block>
                            </th:block>
                        </td>
                    </tr>
                </th:block>


                </tbody>
            </table>
        </div>

        <th:block th:if="${orderNotFound == 'orderNotFound'}">
            <h3 class="text-red-600 font-semibold p-5">Order Not Found</h3>
        </th:block>

        <th:block th:if="${search != 'search'}">
            <div class="flex justify-center mt-4">
                <nav>
                    <ul class="flex gap-2 text-sm">

                    
                        <li th:if="${currentPage > 0}">
                            <a th:href="@{'/admin/orders?page=' + ${currentPage - 1}}" 
                            class="px-3 py-2 font-semibold rounded"><<<</a>
                        </li>

                        <li th:if="${startPage > 0}">
                            <a th:href="@{'/admin/orders?page=0'}" 
                            class="px-3 py-2 font-semibold rounded">1</a>
                        </li>

                        <li th:if="${startPage > 1}">
                            <span class="px-3 py-2">...</span>
                        </li>

                        <li th:each="i : ${#numbers.sequence(startPage, endPage)}">
                            <a th:href="@{'/admin/orders?page=' + ${i}}"
                            th:classappend="${currentPage == i} ? 'bg-blue-600 text-white' : ''"
                            class="px-3 py-2 rounded font-semibold"
                            th:text="${i + 1}"></a>
                        </li>

                        <li th:if="${endPage < totalPages - 2}">
                            <span class="px-3 py-2">...</span>
                        </li>

                        <li th:if="${endPage < totalPages - 1}">
                            <a th:href="@{'/admin/orders?page=' + ${totalPages - 1}}"
                            class="px-3 py-2 font-semibold rounded"
                            th:text="${totalPages}"></a>
                        </li>

                        <li th:if="${currentPage < totalPages - 1}">
                            <a th:href="@{'/admin/orders?page=' + ${currentPage + 1}}" 
                            class="px-3 py-2 font-semibold rounded">>>></a>
                        </li>

                    </ul>
                    </nav>
                </div>
        </th:block>
        


    </div>
</section>
</div>
</body>
</html>
