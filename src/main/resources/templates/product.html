<!DOCTYPE html>
<html lang="en" th:replace="~{index :: parent(~{::#content}, ~{::title})}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gopal Shopping | Products</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.3/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://unpkg.com/scrollreveal"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div id="content">
   <div class="grid grid-cols-1 md:grid-cols-12 gap-6 mt-16 ml-5">
    <div class="bg-white absolute shadow-lg p-4 w-44 group md:col-span-3 lg:col-span-2 mt-3">
        <h2 class="text-xl font-semibold mb-2 border-b pb-1 text-blue-600">Categories</h2>
        <ul class="space-y-1 relative z-50 group-hover:block font-light hidden">
          <a th:href="@{/product}" th:value="${all}"
           th:classappend="${paramValue == 'product'} ? 'bg-blue-600 text-white' : ''" class="block px-3 py-2 hover:bg-blue-700 rounded-md font-medium transition">
           All
          </a>
          <a th:each="cat, c : ${category}"
             th:href="@{'/product/view/category/' + ${cat.name}}"
            th:classappend="${paramValue == cat.name} ? 'bg-blue-600 text-white':''"
            class="block px-3 py-2 text-gray-800 rounded-md font-medium hover:bg-blue-700 hover:text-white transition">
              [[${cat.name}]]
            </a>
        </ul>
      </div>
      <div class="md:col-span-10 lg:col-span-11 space-y-8 mt-5">

        <form th:action="@{'/product-search'}" method="post" class="w-full max-w-3xl">
      <div class="flex flex-col ml-52 sm:flex-row items-center">
        <input 
          type="text" 
          name="search"
          placeholder="Search for Products Brands..."
          class="w-full px-4 py-2 rounded-lg focus:outline-none bg-blue-100 text-gray-800 mb-3 sm:mb-0"
        />
        <button 
          type="submit"
          class="ml-0 sm:ml-3 px-6 py-2 bg-white text-blue-700 font-semibold rounded-lg hover:bg-blue-100 transition-all duration-300 flex items-center justify-center">
          <i class="fa-solid fa-magnifying-glass mr-2"></i>Search
        </button>
      </div>
    </form>
      </div>
  </div>

<th:block th:if="${session.successMsg}">
  <p class="bg-green-100 text-green-700 text-center px-4 mt-2 py-2 rounded-lg font-semibold">[[${session.successMsg}]]</p>
  <th:block th:text="${@commonServiceImpl.removeMessage()}"></th:block>
</th:block>

<th:block th:if="${session.errorMsg}">
  <p class="bg-red-100 text-red-700 text-center mt-2 px-4 py-2 rounded-lg font-semibold">[[${session.errorMsg}]]</p>
  <th:block th:text="${@commonServiceImpl.removeMessage()}"></th:block>
</th:block>

<div class="w-full mt-5 px-4 lg:px-4">
    
    <div class="w-full">
      <div class="bg-white shadow-lg rounded-lg p-6">
        <h2 class="text-2xl font-semibold text-center text-blue-600 mb-6">Products</h2>
        
        
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 lg:grid-cols-5 gap-6">

          <th:block th:if="${categoryName == 'search'}">
          <div th:each="prod, p : ${pageProduct}" class="bg-gray-50 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
            <a th:href="@{'/product/view/'+${prod.id}}">
            <img th:src="@{'/images/products/'+${prod.imageName}}" alt="Laptop" class="w-full h-40 object-cover rounded-t-lg">
            <div class="p-4 text-center">
              <p class="font-semibold text-gray-800 mb-2">[[${prod.title}]]</p>
              <p class="text-gray-900 text-2xl">
                ₹ [[${prod.discountPrice}]] 
                <span class="text-green-600 text-sm">[[${prod.discount}]]% off</span>
              </p>
              <p
                 class="inline-block bg-blue-600 text-white px-4 py-2 rounded-md font-medium hover:bg-blue-700 transition duration-200">
                View Details
              </p>
            </div>
            </a>
          </div>
          </th:block>

          <th:block th:if="${categoryName == 'categoryName'}">
          <div th:each="prod, p : ${pageProduct}" class="bg-gray-50 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
            <a th:href="@{'/product/view/'+${prod.id}}">
            <img th:src="@{'/images/products/'+${prod.imageName}}" alt="Laptop" class="w-full h-40 object-cover rounded-t-lg">
            <div class="p-4 text-center">
              <p class="font-semibold text-gray-800 mb-2">[[${prod.title}]]</p>
              <p class="text-gray-900 text-2xl">
                ₹ [[${prod.discountPrice}]] 
                <span class="text-green-600 text-sm">[[${prod.discount}]]% off</span>
              </p>
              <p
                 class="inline-block bg-blue-600 text-white px-4 py-2 rounded-md font-medium hover:bg-blue-700 transition duration-200">
                View Details
              </p>
            </div>
            </a>
          </div>
          </th:block>

          <th:block th:if="${categoryName == 'products'}">
          <div th:each="prod, p : ${pageProducts.content}" class="bg-gray-50 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
            <a th:href="@{'/product/view/'+${prod.id}}">
            <img th:src="@{'/images/products/'+${prod.imageName}}" alt="Laptop" class="w-full h-40 object-cover rounded-t-lg">
            <div class="p-4 text-center">
              <p class="font-semibold text-gray-800 mb-2">[[${prod.title}]]</p>
              <p class="text-gray-900 text-2xl">
                ₹ [[${prod.discountPrice}]] 
                <span class="text-green-600 text-sm">[[${prod.discount}]]% off</span>
              </p>
              <p
                 class="inline-block bg-blue-600 text-white px-4 py-2 rounded-md font-medium hover:bg-blue-700 transition duration-200">
                View Details
              </p>
            </div>
            </a>
          </div>
          </th:block>        
        </div>

        <th:block th:if="${productNotFound == 'productNotFound'}">
            <h3 class="text-red-600 font-semibold p-5">Product Not Found</h3>
        </th:block>

        <th:block th:if="${categoryName == 'products'}">
          <div class="flex justify-center p-5 mt-4">
            <nav>
              <ul class="flex gap-2 text-sm">

                
                  <li th:if="${currentPage > 0}">
                      <a th:href="@{'/product?page=' + ${currentPage - 1}}" 
                        class="px-3 py-2 font-semibold rounded"><<<</a>
                  </li>

                  <li th:if="${startPage > 0}">
                      <a th:href="@{'/product?page=0'}" 
                        class="px-3 py-2 font-semibold rounded">1</a>
                  </li>

                  <li th:if="${startPage > 1}">
                      <span class="px-3 py-2">...</span>
                  </li>

                  <li th:each="i : ${#numbers.sequence(startPage, endPage)}">
                      <a th:href="@{'/product?page=' + ${i}}"
                        th:classappend="${currentPage == i} ? 'bg-blue-600 text-white' : ''"
                        class="px-3 py-2 rounded font-semibold"
                        th:text="${i + 1}"></a>
                  </li>

                  <li th:if="${endPage < totalPages - 2}">
                      <span class="px-3 py-2">...</span>
                  </li>

                  <li th:if="${endPage < totalPages - 1}">
                      <a th:href="@{'/product?page=' + ${totalPages - 1}}"
                        class="px-3 py-2 font-semibold rounded"
                        th:text="${totalPages}"></a>
                  </li>

                  <li th:if="${currentPage < totalPages - 1}">
                      <a th:href="@{'/product?page=' + ${currentPage + 1}}" 
                        class="px-3 py-2 font-semibold rounded">>>></a>
                  </li>

                </ul>
              </nav>
            </div>
          </th:block>

      </div>
    </div>  
</div> 




  <script>
    ScrollReveal().reveal('[data-sr="fade-up"]', {
      duration: 800,
      origin: 'bottom',
      distance: '40px',
      delay: 100
    });
  </script>

  <script>
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    const productGrid = document.getElementById('productGrid');
    const productCards = Array.from(productGrid.children);

    searchInput.addEventListener('input', () => {
      const term = searchInput.value.toLowerCase();
      productCards.forEach(card => {
        const name = card.querySelector('h3').textContent.toLowerCase();
        card.style.display = name.includes(term) ? 'block' : 'none';
      });
    });

    sortSelect.addEventListener('change', () => {
      const option = sortSelect.value;
      let sorted = [...productCards];

      if (option === 'low-high') {
        sorted.sort((a, b) => getPrice(a) - getPrice(b));
      } else if (option === 'high-low') {
        sorted.sort((a, b) => getPrice(b) - getPrice(a));
      } else if (option === 'name') {
        sorted.sort((a, b) => getName(a).localeCompare(getName(b)));
      }

      productGrid.innerHTML = '';
      sorted.forEach(card => productGrid.appendChild(card));
    });

    function getPrice(card) {
      return parseFloat(card.querySelector('span').textContent.replace('₹', ''));
    }

    function getName(card) {
      return card.querySelector('h3').textContent;
    }
  </script>

  </div>

</body>

</html>
