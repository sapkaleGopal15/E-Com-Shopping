<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{index :: parent(~{::#content}, ~{::title})}">

<head>
  <meta charset="UTF-8">
  <title>Gopal Shop | My Orders</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-linear-to-br from-blue-50 via-indigo-50 to-white min-h-screen">
  <div id="content">
    <section class="py-10 mt-2">
      <div class="container mx-auto px-4">

        <div
          class="bg-white shadow-2xl rounded-2xl p-8 border border-gray-100 transition transform hover:shadow-indigo-200 duration-300">

          <div class="flex justify-end mb-2">
          <a th:href="@{'/user/dashboard'}"
            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
            ‚Üê Back
          </a>
        </div>

          <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-indigo-600 animate-fade-in">üì¶ My Orders</h1>

            <th:block th:if="${session.successMsg}">
              <p class="text-green-600 font-semibold mt-2 animate-fade-in">[[${session.successMsg}]]</p>
              <th:block th:text="${@commonServiceImpl.removeMessage()}"></th:block>
            </th:block>

            <th:block th:if="${session.errorMsg}">
              <p class="text-red-500 font-semibold mt-2 animate-fade-in">[[${session.errorMsg}]]</p>
              <th:block th:text="${@commonServiceImpl.removeMessage()}"></th:block>
            </th:block>
          </div>


          <div class="overflow-x-auto">
            <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden shadow-sm">
              <thead>
                <tr class="bg-indigo-600 text-white uppercase text-sm tracking-wider">
                  <th class="py-3 px-4 text-left">Order No.</th>
                  <th class="py-3 px-4 text-left">Date</th>
                  <th class="py-3 px-4 text-left">Product Details</th>
                  <th class="py-3 px-4 text-left">Price</th>
                  <th class="py-3 px-4 text-left">Status</th>
                  <th class="py-3 px-4 text-center">Action</th>
                </tr>
              </thead>

              <tbody class="divide-y divide-gray-200 text-gray-700">

                <tr th:each="order, c : ${orders}" class="hover:bg-indigo-50 transition duration-300 ease-in-out">

                  <td class="py-3 px-4 font-semibold text-gray-800">[[${c.count}]]</td>
                  <td class="py-3 px-4">[[${order.orderDate}]]</td>
                  <td class="py-3 px-4 font-medium">[[${order.productNames}]]</td>
                  <td class="py-3 px-4 font-medium">‚Çπ[[${order.orderPrice}]]</td>

                  <td class="py-3 px-4">
                    <div th:switch="${order.status}" class="px-3 py-1 rounded-full text-sm font-semibold shadow-sm">
                      <span th:case="Cancelled" class="text-red-600">Cancelled</span>
                      <span th:case="Delivered" class="text-green-600">Delivered</span>
                      <span th:case="*" class="text-blue-600">[[${order.status}]]</span>
                    </div>
                  </td>

                  <td class="py-3 px-4 text-center">
                    <th:block th:if="${order.status == 'Cancelled'}">
                      <span class="font-semibold">Reason:</span><br> [[${order.cancelReason}]]
                    </th:block>

                    <th:block th:unless="${order.status == 'Cancelled'}">
                      <th:block th:if="${order.status == 'Delivered'}">
                        <span class="font-semibold">Order:</span><br> [[${order.cancelReason}]]
                      </th:block>
                      
                      <th:block th:unless="${order.status == 'Delivered'}">
                        <th:block th:if="${order.status != 'Cancelled' && order.status != 'Delivered'}">
                                  <label for="toggleCancel" class="open-modal bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-1 
                                    rounded-lg shadow transition transform hover:scale-105 cursor-pointer"
                                    th:attr="data-id=${order.id}">
                                      Cancel
                                  </label>
                        </th:block>

                        <th:block th:unless="${order.status != 'Cancelled' && order.status != 'Delivered'}">
                                  <button class="bg-gray-300 text-gray-500 text-sm px-3 py-1 
                                    rounded-lg cursor-not-allowed shadow-sm">
                                      Cancelled
                                  </button>
                        </th:block>
                      </th:block>
                    </th:block>
                          
                  </td>
                </tr>

              </tbody>




              <input type="checkbox" id="toggleCancel" class="hidden peer" />

              <div class="fixed inset-0 bg-black/40 flex items-center justify-center z-50
            opacity-0 pointer-events-none scale-90 transition-all duration-300
            peer-checked:opacity-100 peer-checked:scale-100 peer-checked:pointer-events-auto">

                <div class="bg-white w-96 p-6 rounded-xl shadow-xl">
                  <h2 class="text-xl font-semibold mb-4 text-red-600 text-center">Cancel Order</h2>

                  <form th:action="@{'/user/order/update-status'}" method="post">

                    <input type="hidden" name="orderId" id="cancelOrderId">

                    <label class="block text-sm font-medium mb-1">Reason:</label>
                    <textarea name="reason" rows="3" required placeholder="Please enter order cancel reason..."
                      class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-red-500 outline-none"></textarea>

                    <div class="flex justify-end gap-3 mt-4">

                      <label for="toggleCancel"
                        class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg cursor-pointer">
                        Back
                      </label>

                      <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                        Confirm Cancel
                      </button>
                    </div>
                  </form>
                </div>
              </div>


            </table>
          </div>

        </div>
      </div>
    </section>



    <style>
      @keyframes fade-in {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-fade-in {
        animation: fade-in 0.7s ease-in-out;
      }

      @keyframes popup {
        from {
          transform: scale(0.8);
          opacity: 0;
        }

        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .animate-popup {
        animation: popup 0.3s ease-out;
      }
    </style>







    <script>
      document.addEventListener("DOMContentLoaded", () => {

        const hiddenInput = document.getElementById("cancelOrderId");

        document.querySelectorAll(".open-modal").forEach(btn => {
          btn.addEventListener("click", () => {
            hiddenInput.value = btn.getAttribute("data-id");
            console.log("Order ID Set =", hiddenInput.value);
          });
        });

      });
    </script>

  </div>
</body>





</html>